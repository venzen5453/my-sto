<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ ìŠ¤ë§ˆíŠ¸ ê°€ê³„ë¶€ - ë‹¬ë ¥í˜•</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --income-color: #2ecc71;
            --expense-color: #e74c3c;
            --bg-color: #f8f9fa;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* í—¤ë”: ì”ì•¡ ë° ë‚ ì§œ ì„ íƒ */
        .header {
            background: var(--primary-color);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .date-selector {
            margin-bottom: 10px;
        }

        .date-selector input {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1rem;
            outline: none;
            cursor: pointer;
        }

        .header h1 { margin: 0; font-size: 1.2rem; opacity: 0.9; }
        .total-amount { font-size: 2.5rem; font-weight: 800; margin: 10px 0; }
        
        .asset-split {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
        }

        /* ì…ë ¥ ì„¹ì…˜ */
        .input-box {
            padding: 20px;
            border-bottom: 8px solid #f0f2f5;
        }

        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        input, select {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
        }

        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        button {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-plus { background: #e8f5e9; color: var(--income-color); }
        .btn-minus { background: #ffebee; color: var(--expense-color); }
        button:active { transform: scale(0.98); }

        /* ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ */
        .list-container { padding: 20px; min-height: 200px; }
        .list-title { font-weight: bold; margin-bottom: 15px; display: flex; justify-content: space-between; }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .item-info { display: flex; flex-direction: column; }
        .item-main { font-weight: 600; font-size: 1.05rem; }
        .item-sub { font-size: 0.8rem; color: #888; margin-top: 4px; }
        .tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            background: #eee;
            margin-right: 5px;
        }

        .item-amount { font-weight: bold; font-size: 1.1rem; }
        .income { color: var(--income-color); }
        .expense { color: var(--expense-color); }

        .delete-btn {
            background: none;
            color: #ccc;
            padding: 5px;
            font-size: 0.8rem;
        }

        .empty-msg {
            text-align: center;
            color: #ccc;
            margin-top: 40px;
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <div class="date-selector">
            <input type="date" id="date-picker" onchange="changeDate()">
        </div>
        <h1 id="display-date">2026ë…„ 2ì›” 5ì¼</h1>
        <div class="total-amount" id="total-balance">0ì›</div>
        <div class="asset-split">
            <div>ğŸ’µ í˜„ê¸ˆ: <span id="cash-balance">0</span></div>
            <div>ğŸ’³ ì¹´ë“œ: <span id="card-balance">0</span></div>
        </div>
    </div>

   <div class="input-box">
        <div class="input-row">
            <input type="number" id="amount-input" inputmode="numeric" pattern="[0-9]*" placeholder="ê¸ˆì•¡ ì…ë ¥">
            <select id="category-input">
                <option value="ì‹ë¹„">ğŸ” ì‹ë¹„</option>
                <option value="êµí†µ">ğŸšŒ êµí†µ</option>
                <option value="ì‡¼í•‘">ğŸ›ï¸ ì‡¼í•‘</option>
                <option value="ì˜ë£Œ">ğŸ¥ ì˜ë£Œ</option>
                <option value="ì›”ê¸‰">ğŸ’° ìˆ˜ì…</option>
            </select>
        </div>
        <div class="button-grid">
            <button class="btn-plus" onclick="handleTransaction('plus', 'cash')">í˜„ê¸ˆ ì…ê¸ˆ</button>
            <button class="btn-plus" onclick="handleTransaction('plus', 'card')">ì¹´ë“œ ì…ê¸ˆ</button>
            <button class="btn-minus" onclick="handleTransaction('minus', 'cash')">í˜„ê¸ˆ ì¶œê¸ˆ</button>
            <button class="btn-minus" onclick="handleTransaction('minus', 'card')">ì¹´ë“œ ì¶œê¸ˆ</button>
        </div>
    </div>

    <div class="list-container">
        <div class="list-title">
            <span>ë‚´ì—­ ë¦¬ìŠ¤íŠ¸</span>
            <span id="selected-date-text" style="font-size: 0.8rem; color: #aaa;"></span>
        </div>
        <div id="history-list">
            </div>
    </div>
</div>

<script>
    // 1. ë°ì´í„° ìƒíƒœ ê´€ë¦¬ (êµ¬ì¡° ë³€ê²½: historyë¥¼ ë‚ ì§œë³„ ê°ì²´ë¡œ ê´€ë¦¬)
    let state = JSON.parse(localStorage.getItem('myLedgerDataV2')) || {
        cash: 0,
        card: 0,
        dailyHistory: {} // ì˜ˆ: {"2026-02-05": [...]}
    };

    let currentDate = ""; // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ (YYYY-MM-DD)

    // ì´ˆê¸°í™” í•¨ìˆ˜
    function init() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        
        currentDate = `${year}-${month}-${day}`;
        document.getElementById('date-picker').value = currentDate;
        
        updateUI();
    }

    // ë‚ ì§œ ë³€ê²½ ì‹œ í˜¸ì¶œ
    function changeDate() {
        currentDate = document.getElementById('date-picker').value;
        updateUI();
    }

    // 2. í™”ë©´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateUI() {
        // ë‚ ì§œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        document.getElementById('display-date').innerText = new Date(currentDate).toLocaleDateString('ko-KR', options);
        document.getElementById('selected-date-text').innerText = currentDate;

        // ì”ì•¡ ì—…ë°ì´íŠ¸
        document.getElementById('cash-balance').innerText = state.cash.toLocaleString() + "ì›";
        document.getElementById('card-balance').innerText = state.card.toLocaleString() + "ì›";
        document.getElementById('total-balance').innerText = (state.cash + state.card).toLocaleString() + "ì›";

        // í•´ë‹¹ ë‚ ì§œ ë‚´ì—­ ë¶ˆëŸ¬ì˜¤ê¸°
        const historyList = document.getElementById('history-list');
        const dayData = state.dailyHistory[currentDate] || [];

        if (dayData.length === 0) {
            historyList.innerHTML = `<div class="empty-msg">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
        } else {
            historyList.innerHTML = dayData.map((item, index) => `
                <div class="history-item">
                    <div class="item-info">
                        <div class="item-main">${item.category}</div>
                        <div class="item-sub">
                            <span class="tag">${item.method}</span>
                            <button class="delete-btn" onclick="deleteItem(${index})">ì‚­ì œ</button>
                        </div>
                    </div>
                    <div class="item-amount ${item.type === 'plus' ? 'income' : 'expense'}">
                        ${item.type === 'plus' ? '+' : '-'}${item.amount.toLocaleString()}ì›
                    </div>
                </div>
            `).join('');
        }

        localStorage.setItem('myLedgerDataV2', JSON.stringify(state));
    }

    // 3. ì…ì¶œê¸ˆ ì²˜ë¦¬ í•¨ìˆ˜
    function handleTransaction(type, method) {
        const amountInput = document.getElementById('amount-input');
        const categoryInput = document.getElementById('category-input');
        const amount = parseInt(amountInput.value);

        if (!amount || amount <= 0) {
            alert("ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }

        // ì „ì²´ ì”ì•¡ ê³„ì‚° (ì”ì•¡ì€ ë‚ ì§œì™€ ìƒê´€ì—†ì´ ìœ ì§€ë¨)
        if (method === 'cash') {
            state.cash += (type === 'plus' ? amount : -amount);
        } else {
            state.card += (type === 'plus' ? amount : -amount);
        }

        // í•´ë‹¹ ë‚ ì§œì˜ ë°°ì—´ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
        if (!state.dailyHistory[currentDate]) {
            state.dailyHistory[currentDate] = [];
        }

        // í•´ë‹¹ ë‚ ì§œ ë‚´ì—­ì— ì¶”ê°€
        state.dailyHistory[currentDate].unshift({
            type,
            method: method === 'cash' ? 'í˜„ê¸ˆ' : 'ì¹´ë“œ',
            category: categoryInput.value,
            amount: amount,
            timestamp: new Date().getTime()
        });

        amountInput.value = '';
        updateUI();
    }

    // 4. ë‚´ì—­ ì‚­ì œ ê¸°ëŠ¥
    function deleteItem(index) {
        if (!confirm("ì´ ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì „ì²´ ì”ì•¡ë„ ë³µêµ¬ë©ë‹ˆë‹¤.")) return;
        
        const item = state.dailyHistory[currentDate][index];
        
        // ì‚­ì œ ì‹œ ì—­ê³„ì‚°ìœ¼ë¡œ ì „ì²´ ì”ì•¡ ë³µêµ¬
        if (item.method === 'í˜„ê¸ˆ') {
            state.cash += (item.type === 'plus' ? -item.amount : item.amount);
        } else {
            state.card += (item.type === 'plus' ? -item.amount : item.amount);
        }

        state.dailyHistory[currentDate].splice(index, 1);
        updateUI();
    }

    // ì´ˆê¸° ì‹¤í–‰
    init();
</script>

</body>
</html>
