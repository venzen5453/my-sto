<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ì‹¬í”Œ ìŠ¤ë§ˆíŠ¸ ê°€ê³„ë¶€ Pro</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --income-color: #2ecc71;
            --expense-color: #e74c3c;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --header-bg: #2c3e50;
            --text-main: #2c3e50;
            --cash-accent: #fcc419;
            --card-accent: #4dabf7;
            --border-color: #f1f1f1;
        }

        [data-theme='dark'] {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --header-bg: #121212;
            --text-main: #f5f5f5;
            --border-color: #3d3d3d;
        }

        /* [í•µì‹¬] ì „ì²´ ìŠ¤í¬ë¡¤ ê¸ˆì§€ */
        html, body {
            height: 100%; margin: 0; padding: 0;
            overflow: hidden; background-color: #333;
            display: flex; justify-content: center; align-items: center;
        }

        .app-container {
            width: 430px; height: 932px; /* iPhone 14 Pro Max Size */
            background: var(--card-bg); color: var(--text-main);
            display: flex; flex-direction: column;
            position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            overflow: hidden; transition: 0.3s;
        }

        /* íƒ­ êµ¬ì¡° */
        .tab-content { display: none; flex-direction: column; height: 100%; overflow: hidden; }
        .tab-content.active { display: flex; }

        /* ìƒë‹¨ í—¤ë” ê³ ì • */
        .header {
            background: var(--header-bg); color: white;
            padding: 50px 20px 20px 20px; text-align: center; flex-shrink: 0;
        }
        .total-amount { font-size: 2.5rem; font-weight: 800; margin: 10px 0; }
        .monthly-summary {
            display: flex; background: rgba(0,0,0,0.2); border-radius: 15px;
            margin: 15px 0; padding: 12px; font-size: 0.8rem; justify-content: space-around;
        }
        .asset-split { display: flex; justify-content: space-around; gap: 8px; }
        .asset-item { flex: 1; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }

        /* ì…ë ¥ ì˜ì—­ ê³ ì • */
        .input-box { padding: 20px; border-bottom: 8px solid var(--bg-color); flex-shrink: 0; }
        .main-input {
            width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 12px;
            font-size: 1.5rem; font-weight: bold; text-align: center; margin-bottom: 10px;
            box-sizing: border-box; outline: none; background: var(--bg-color); color: var(--text-main);
        }
        .button-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .button-grid button { padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; }

        /* [í•µì‹¬] ë‚´ë¶€ ìŠ¤í¬ë¡¤ ì˜ì—­ */
        .scroll-area {
            flex: 1; overflow-y: auto; padding: 0 20px;
            -webkit-overflow-scrolling: touch;
        }
        .scroll-area::-webkit-scrollbar { display: none; }

        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border-color); }
        .tag { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; margin-right: 5px; }
        .tag-cash { background: #fff9db; color: #f08c00; }
        .tag-card { background: #e7f5ff; color: #1971c2; }
        .delete-btn { background: none; border: none; color: #ccc; cursor: pointer; font-size: 0.75rem; }

        /* í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜ ê³ ì • */
        .nav-bar {
            height: 85px; background: var(--card-bg); border-top: 1px solid var(--border-color);
            display: flex; justify-content: space-around; align-items: center; flex-shrink: 0;
            padding-bottom: 20px;
        }
        .nav-item { border: none; background: none; color: #888; font-size: 0.75rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px; flex: 1; }
        .nav-item.active { color: var(--primary-color); font-weight: bold; }
        .nav-icon { font-size: 1.4rem; }

        /* ëª¨ë‹¬ */
        #modal-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; }
        .modal { background: var(--card-bg); width: 85%; border-radius: 20px; padding: 25px; }
        .category-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .cat-btn { padding: 10px 5px; border: 1px solid var(--border-color); border-radius: 10px; background: var(--bg-color); color: var(--text-main); font-size: 0.8rem; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .cat-btn.active { background: var(--primary-color); color: white; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="modal-overlay">
        <div class="modal">
            <div style="font-weight: bold; margin-bottom: 20px; text-align: center;">ë¶„ë¥˜ ì„ íƒ</div>
            <div class="category-grid" id="category-selector"></div>
            <input type="text" id="note-input" class="main-input" style="font-size:1rem !important; text-align:left;" placeholder="ìƒì„¸ ë©”ëª¨ (ì„ íƒ)">
            <div style="display:flex; gap:10px;">
                <button onclick="closeModal()" style="flex:1; padding:12px; border:none; background:#eee; border-radius:10px; color:#333;">ì·¨ì†Œ</button>
                <button onclick="confirmTransaction()" style="flex:1; padding:12px; border:none; background:var(--primary-color); color:white; border-radius:10px; font-weight:bold;">ì €ì¥</button>
            </div>
        </div>
    </div>

    <div id="tab-home" class="tab-content active">
        <div class="header">
            <div style="display:flex; align-items:center; justify-content:center; gap:15px; margin-bottom:10px;">
                <button onclick="moveDate(-1)" style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;">â—€</button>
                <input type="date" id="date-picker" onchange="updateUI()" style="background:rgba(255,255,255,0.1); border:none; color:white; padding:5px 10px; border-radius:10px; font-size:0.9rem; color-scheme:dark;">
                <button onclick="moveDate(1)" style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;">â–¶</button>
            </div>
            <div class="total-amount" id="total-balance">Â¥0</div>
            <div class="monthly-summary">
                <div><span>í•œ ë‹¬ ìˆ˜ì…</span><b id="month-in" style="color:#2ecc71">Â¥0</b></div>
                <div><span>í•œ ë‹¬ ì§€ì¶œ</span><b id="month-out" style="color:#ff6b6b">Â¥0</b></div>
            </div>
            <div class="asset-split">
                <div class="asset-item"><span style="color:var(--cash-accent); font-size:0.8rem;">í˜„ê¸ˆ</span><div id="cash-balance" style="font-weight:800; color:var(--cash-accent)">Â¥0</div></div>
                <div class="asset-item"><span style="color:var(--card-accent); font-size:0.8rem;">ì¹´ë“œ</span><div id="card-balance" style="font-weight:800; color:var(--card-accent)">Â¥0</div></div>
            </div>
        </div>
        
        <div class="input-box">
            <input type="number" id="amount-input" class="main-input" inputmode="numeric" placeholder="0">
            <div class="button-grid">
                <button style="background:#e8f5e9; color:#2ecc71;" onclick="openModal('plus', 'cash')">í˜„ê¸ˆ ì…ê¸ˆ</button>
                <button style="background:#e8f5e9; color:#2ecc71;" onclick="openModal('plus', 'card')">ì¹´ë“œ ì…ê¸ˆ</button>
                <button style="background:#ffebee; color:#e74c3c;" onclick="openModal('minus', 'cash')">í˜„ê¸ˆ ì¶œê¸ˆ</button>
                <button style="background:#ffebee; color:#e74c3c;" onclick="openModal('minus', 'card')">ì¹´ë“œ ì¶œê¸ˆ</button>
            </div>
        </div>

        <div class="scroll-area">
            <h4 style="margin: 20px 0 10px 0; color: var(--text-main);">ì˜¤ëŠ˜ì˜ ê±°ë˜ ë‚´ì—­</h4>
            <div id="history-list"></div>
        </div>
    </div>

    <div id="tab-search" class="tab-content">
        <div class="header"><h2>ê±°ë˜ ê²€ìƒ‰</h2></div>
        <div style="padding: 20px; flex-shrink:0;">
            <input type="text" id="search-input" class="main-input" style="font-size:1.1rem; text-align:left;" placeholder="ë¶„ë¥˜ë‚˜ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeyup="searchHistory()">
        </div>
        <div class="scroll-area" id="search-results"></div>
    </div>

    <div id="tab-more" class="tab-content">
        <div class="header"><h2>ì„¤ì •</h2></div>
        <div class="scroll-area" style="padding-top:20px;">
            <div style="background:var(--bg-color); padding:20px; border-radius:15px; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                <span>ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</span>
                <button onclick="toggleTheme()" id="theme-status" style="padding:8px 20px; border-radius:20px; border:1px solid var(--primary-color); background:none; color:var(--primary-color); font-weight:bold;">OFF</button>
            </div>
            <div style="background:var(--bg-color); padding:20px; border-radius:15px; display:flex; justify-content:space-between; align-items:center;">
                <span>ğŸ“‚ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</span>
                <button onclick="exportCSV()" style="padding:10px 20px; border-radius:10px; border:none; background:var(--primary-color); color:white; font-weight:bold;">CSV ì €ì¥</button>
            </div>
        </div>
    </div>

    <nav class="nav-bar">
        <button class="nav-item active" onclick="switchTab('home', this)"><span class="nav-icon">ğŸ </span>í™ˆ</button>
        <button class="nav-item" onclick="switchTab('search', this)"><span class="nav-icon">ğŸ”</span>ê²€ìƒ‰</button>
        <button class="nav-item" onclick="switchTab('more', this)"><span class="nav-icon">âš™ï¸</span>ì„¤ì •</button>
    </nav>
</div>

<script>
    const categories = {
        plus: [{name:'ì›”ê¸‰',icon:'ğŸ’°'},{name:'ìš©ëˆ',icon:'ğŸ'},{name:'ë¶€ìˆ˜ì…',icon:'ğŸ“ˆ'},{name:'ê¸ˆìœµ',icon:'ğŸ¦'},{name:'ê¸°íƒ€',icon:'âœ¨'}],
        minus: [{name:'ì‹ë¹„',icon:'ğŸ”'},{name:'êµí†µë¹„',icon:'ğŸšŒ'},{name:'ì—¬ê°€',icon:'ğŸ®'},{name:'ì‡¼í•‘',icon:'ğŸ›ï¸'},{name:'ì˜ë£Œ',icon:'ğŸ¥'},{name:'ê¸°íƒ€',icon:'âœ¨'}]
    };

    let state = JSON.parse(localStorage.getItem('finalLedger_V3')) || { cash: 0, card: 0, dailyHistory: {}, isDark: false };
    let currentTransaction = null;
    let selectedCategory = "";

    function init() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date-picker').value = today;
        if(state.isDark) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('theme-status').innerText = 'ON';
        }
        updateUI();
    }

    function switchTab(tabName, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
        el.classList.add('active');
    }

    function toggleTheme() {
        state.isDark = !state.isDark;
        document.documentElement.setAttribute('data-theme', state.isDark ? 'dark' : 'light');
        document.getElementById('theme-status').innerText = state.isDark ? 'ON' : 'OFF';
        save();
    }

    function searchHistory() {
        const q = document.getElementById('search-input').value.toLowerCase();
        const resBox = document.getElementById('search-results');
        if(!q) { resBox.innerHTML = ""; return; }
        let html = "";
        Object.keys(state.dailyHistory).sort().reverse().forEach(date => {
            state.dailyHistory[date].forEach(item => {
                if(item.category.includes(q) || item.note.toLowerCase().includes(q)) {
                    html += `<div class="history-item"><div><b>[${date}]</b> ${item.category}<br><small>${item.note}</small></div><div style="color:${item.type==='plus'?'var(--income-color)':'var(--expense-color)'}; font-weight:bold;">Â¥${item.amount.toLocaleString()}</div></div>`;
                }
            });
        });
        resBox.innerHTML = html || "<p style='text-align:center; padding:50px; color:#ccc;'>ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
    }

    function exportCSV() {
        let csv = "ë‚ ì§œ,ë¶„ë¥˜,ìˆ˜ë‹¨,ê¸ˆì•¡,ë©”ëª¨\n";
        Object.keys(state.dailyHistory).forEach(date => {
            state.dailyHistory[date].forEach(i => csv += `${date},${i.category},${i.method},${i.amount},${i.note}\n`);
        });
        const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "ê°€ê³„ë¶€_ë°ì´í„°.csv";
        link.click();
    }

    function openModal(type, method) {
        const amt = parseInt(document.getElementById('amount-input').value);
        if(!amt) return alert("ê¸ˆì•¡ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.");
        currentTransaction = { type, method, amount: amt };
        selectedCategory = "";
        const selector = document.getElementById('category-selector');
        selector.innerHTML = categories[type].map(cat => `<button class="cat-btn" onclick="selectCat('${cat.name}', this)"><span>${cat.icon}</span>${cat.name}</button>`).join('');
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function selectCat(n, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedCategory = n;
    }

    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

    function confirmTransaction() {
        if(!selectedCategory) return alert("ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
        const date = document.getElementById('date-picker').value;
        const { type, method, amount } = currentTransaction;
        if(method === 'cash') state.cash += (type==='plus'? amount : -amount);
        else state.card += (type==='plus'? amount : -amount);
        if(!state.dailyHistory[date]) state.dailyHistory[date] = [];
        state.dailyHistory[date].unshift({ type, method: method==='cash'?'í˜„ê¸ˆ':'ì¹´ë“œ', category: selectedCategory, note: document.getElementById('note-input').value || selectedCategory, amount });
        document.getElementById('amount-input').value = "";
        closeModal();
        updateUI();
    }

    function updateUI() {
        const activeDate = document.getElementById('date-picker').value;
        const curMonth = activeDate.substring(0, 7);
        document.getElementById('cash-balance').innerText = "Â¥" + state.cash.toLocaleString();
        document.getElementById('card-balance').innerText = "Â¥" + state.card.toLocaleString();
        document.getElementById('total-balance').innerText = "Â¥" + (state.cash + state.card).toLocaleString();
        
        let mIn = 0, mOut = 0;
        Object.keys(state.dailyHistory).forEach(date => {
            if(date.startsWith(curMonth)) {
                state.dailyHistory[date].forEach(item => {
                    if(item.type === 'plus') mIn += item.amount;
                    else mOut += item.amount;
                });
            }
        });
        document.getElementById('month-in').innerText = "Â¥" + mIn.toLocaleString();
        document.getElementById('month-out').innerText = "Â¥" + mOut.toLocaleString();

        const list = document.getElementById('history-list');
        const dayData = state.dailyHistory[activeDate] || [];
        list.innerHTML = dayData.map((item, i) => `
            <div class="history-item">
                <div><b>${item.category}</b> <small>| ${item.note}</small><br>
                <span class="tag ${item.method==='í˜„ê¸ˆ'?'tag-cash':'tag-card'}">${item.method}</span>
                <button class="delete-btn" onclick="deleteItem('${activeDate}', ${i})">ì‚­ì œ</button></div>
                <div style="font-weight:bold; color:${item.type==='plus'?'var(--income-color)':'var(--expense-color)'}">${item.type==='plus'?'+':'-'}Â¥${item.amount.toLocaleString()}</div>
            </div>`).join('') || '<p style="text-align:center; color:#ccc; padding:50px;">ê±°ë˜ ë‚´ì—­ ì—†ìŒ</p>';
        save();
    }

    function deleteItem(date, i) {
        if(!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
        const item = state.dailyHistory[date][i];
        if(item.method === 'í˜„ê¸ˆ') state.cash += (item.type==='plus' ? -item.amount : item.amount);
        else state.card += (item.type==='plus' ? -item.amount : item.amount);
        state.dailyHistory[date].splice(i, 1);
        updateUI();
    }

    function moveDate(offset) {
        const picker = document.getElementById('date-picker');
        let d = new Date(picker.value);
        d.setDate(d.getDate() + offset);
        picker.value = d.toISOString().split('T')[0];
        updateUI();
    }

    function save() { localStorage.setItem('finalLedger_V3', JSON.stringify(state)); }
    init();
</script>
</body>
</html>
