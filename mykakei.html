<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¬í”Œ ìë™ ê°€ê³„ë¶€</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --income-color: #2ecc71;
            --expense-color: #e74c3c;
            --bg-color: #f8f9fa;
            --cash-accent: #fcc419;
            --card-accent: #4dabf7;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 20px; display: flex; justify-content: center;
        }

        .app-container {
            width: 100%; max-width: 480px; background: white;
            border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden; position: relative; min-height: 90vh;
        }

        /* í—¤ë” */
        .header { background: #2c3e50; color: white; padding: 25px 20px; text-align: center; }
        
        .date-nav { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 10px; }
        .date-nav button { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; opacity: 0.7; }
        .date-nav input { background: rgba(255,255,255,0.1); border: none; color: white; padding: 5px 10px; border-radius: 10px; font-size: 0.9rem; color-scheme: dark; }

        .total-amount { font-size: 2.8rem; font-weight: 800; margin: 10px 0; }
        
        .monthly-summary {
            display: flex; background: rgba(0,0,0,0.2); border-radius: 15px;
            margin: 15px 0; padding: 15px; font-size: 0.85rem; justify-content: space-around;
        }
        .summary-box span { display: block; opacity: 0.7; margin-bottom: 3px; }
        .summary-box b { font-size: 1.1rem; }

        .asset-split { display: flex; justify-content: space-around; gap: 10px; }
        .asset-item { flex: 1; background: rgba(255,255,255,0.05); padding: 12px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .asset-label { font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; display: block; }

        /* ì…ë ¥ ì„¹ì…˜ */
        .input-box { padding: 20px; border-bottom: 8px solid #f0f2f5; }
        .main-input {
            width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 12px;
            font-size: 1.8rem; font-weight: bold; text-align: center; margin-bottom: 15px;
            box-sizing: border-box; outline: none;
        }
        .button-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .button-grid button { padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-plus { background: #e8f5e9; color: var(--income-color); }
        .btn-minus { background: #ffebee; color: var(--expense-color); }

        /* ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ */
        .history-section { padding: 20px; }
        .history-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; color: #333; }
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f1f1f1; }
        .item-info { display: flex; flex-direction: column; gap: 4px; }
        .tag { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; margin-right: 5px; }
        .tag-cash { background: #fff9db; color: #f08c00; }
        .tag-card { background: #e7f5ff; color: #1971c2; }
        .delete-btn { background: none; border: none; color: #ccc; cursor: pointer; font-size: 0.75rem; }

        /* ëª¨ë‹¬ */
        #modal-overlay {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 100; justify-content: center; align-items: center;
        }
        .modal { background: white; width: 85%; border-radius: 20px; padding: 25px; }
        .category-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .cat-btn { padding: 10px 5px; border: 1px solid #eee; border-radius: 10px; background: #f9f9f9; font-size: 0.8rem; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .cat-btn.active { background: var(--primary-color); color: white; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="modal-overlay">
        <div class="modal">
            <div id="modal-header-text" style="font-weight: bold; margin-bottom: 20px; text-align: center;">ë¶„ë¥˜ ì„ íƒ</div>
            <div class="category-grid" id="category-selector"></div>
            <input type="text" id="note-input" style="width:100%; padding:12px; box-sizing:border-box; border:1px solid #ddd; border-radius:10px; margin-bottom:20px;" placeholder="ìƒì„¸ ë©”ëª¨ (ì„ íƒ)">
            <div style="display:flex; gap:10px;">
                <button onclick="closeModal()" style="flex:1; padding:12px; border:none; background:#eee; border-radius:10px;">ì·¨ì†Œ</button>
                <button onclick="confirmTransaction()" style="flex:1; padding:12px; border:none; background:var(--primary-color); color:white; border-radius:10px; font-weight:bold;">ì €ì¥</button>
            </div>
        </div>
    </div>

    <div class="header">
        <div class="date-nav">
            <button onclick="moveDate(-1)">â—€</button>
            <input type="date" id="date-picker" onchange="updateUI()">
            <button onclick="moveDate(1)">â–¶</button>
        </div>
        <div class="total-amount" id="total-balance">Â¥0</div>
        
        <div class="monthly-summary">
            <div class="summary-box"><span>í•œ ë‹¬ ìˆ˜ì…</span><b id="month-in" style="color:#2ecc71">Â¥0</b></div>
            <div class="summary-box"><span>í•œ ë‹¬ ì§€ì¶œ</span><b id="month-out" style="color:#ff6b6b">Â¥0</b></div>
        </div>

        <div class="asset-split">
            <div class="asset-item"><span class="asset-label" style="color:var(--cash-accent)">í˜„ê¸ˆ ì”ì•¡</span><div id="cash-balance" style="font-weight:800; font-size:1.3rem; color:var(--cash-accent)">Â¥0</div></div>
            <div class="asset-item"><span class="asset-label" style="color:var(--card-accent)">ì¹´ë“œ ì”ì•¡</span><div id="card-balance" style="font-weight:800; font-size:1.3rem; color:var(--card-accent)">Â¥0</div></div>
        </div>
    </div>

    <div class="input-box">
        <input type="number" id="amount-input" class="main-input" inputmode="numeric" placeholder="0">
        <div class="button-grid">
            <button class="btn-plus" onclick="openModal('plus', 'cash')">í˜„ê¸ˆ ì…ê¸ˆ</button>
            <button class="btn-plus" onclick="openModal('plus', 'card')">ì¹´ë“œ ì…ê¸ˆ</button>
            <button class="btn-minus" onclick="openModal('minus', 'cash')">í˜„ê¸ˆ ì¶œê¸ˆ</button>
            <button class="btn-minus" onclick="openModal('minus', 'card')">ì¹´ë“œ ì¶œê¸ˆ</button>
        </div>
    </div>

    <div class="history-section">
        <div class="history-title">ì˜¤ëŠ˜ì˜ ê±°ë˜ ë‚´ì—­</div>
        <div id="history-list"></div>
    </div>
</div>

<script>
    const categories = {
        plus: [{name:'ì›”ê¸‰',icon:'ğŸ’°'},{name:'ìš©ëˆ',icon:'ğŸ'},{name:'ë¶€ìˆ˜ì…',icon:'ğŸ“ˆ'},{name:'ê¸ˆìœµ',icon:'ğŸ¦'},{name:'ê¸°íƒ€',icon:'âœ¨'}],
        minus: [{name:'ì‹ë¹„',icon:'ğŸ”'},{name:'êµí†µë¹„',icon:'ğŸšŒ'},{name:'ì—¬ê°€',icon:'ğŸ®'},{name:'ì‡¼í•‘',icon:'ğŸ›ï¸'},{name:'ì˜ë£Œ',icon:'ğŸ¥'},{name:'ê¸°íƒ€',icon:'âœ¨'}]
    };

    let state = JSON.parse(localStorage.getItem('smartLedgerData_V11')) || { cash: 0, card: 0, dailyHistory: {} };
    let currentTransaction = null;
    let selectedCategory = "";

    function init() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date-picker').value = today;
        updateUI();
    }

    function moveDate(offset) {
        const dateInput = document.getElementById('date-picker');
        let d = new Date(dateInput.value);
        d.setDate(d.getDate() + offset);
        dateInput.value = d.toISOString().split('T')[0];
        updateUI();
    }

    function openModal(type, method) {
        const amt = parseInt(document.getElementById('amount-input').value);
        if(!amt || amt <= 0) return alert("ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.");
        currentTransaction = { type, method, amount: amt };
        selectedCategory = "";
        
        const selector = document.getElementById('category-selector');
        selector.innerHTML = "";
        categories[type].forEach(cat => {
            const btn = document.createElement('button');
            btn.className = 'cat-btn';
            btn.innerHTML = `<span style="font-size:1.2rem">${cat.icon}</span>${cat.name}`;
            btn.onclick = () => { document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); selectedCategory = cat.name; };
            selector.appendChild(btn);
        });
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

    function confirmTransaction() {
        if(!selectedCategory) return alert("ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
        const { type, method, amount } = currentTransaction;
        const date = document.getElementById('date-picker').value;

        if(method === 'cash') state.cash += (type==='plus'? amount : -amount);
        else state.card += (type==='plus'? amount : -amount);

        if(!state.dailyHistory[date]) state.dailyHistory[date] = [];
        state.dailyHistory[date].unshift({ type, method: method==='cash'?'í˜„ê¸ˆ':'ì¹´ë“œ', category: selectedCategory, note: document.getElementById('note-input').value || selectedCategory, amount });

        document.getElementById('amount-input').value = '';
        closeModal();
        updateUI();
    }

    function updateUI() {
        const activeDate = document.getElementById('date-picker').value;
        const curMonth = activeDate.substring(0, 7);

        // ìƒë‹¨ ì”ì•¡
        document.getElementById('cash-balance').innerText = "Â¥" + state.cash.toLocaleString();
        document.getElementById('card-balance').innerText = "Â¥" + state.card.toLocaleString();
        const total = state.cash + state.card;
        const totalEl = document.getElementById('total-balance');
        totalEl.innerText = "Â¥" + total.toLocaleString();
        totalEl.style.color = total >= 0 ? "var(--income-color)" : "var(--expense-color)";

        // í•œ ë‹¬ í•©ê³„ ê³„ì‚°
        let mIn = 0, mOut = 0;
        Object.keys(state.dailyHistory).forEach(date => {
            if(date.startsWith(curMonth)) {
                state.dailyHistory[date].forEach(item => {
                    if(item.type === 'plus') mIn += item.amount;
                    else mOut += item.amount;
                });
            }
        });
        document.getElementById('month-in').innerText = "Â¥" + mIn.toLocaleString();
        document.getElementById('month-out').innerText = "Â¥" + mOut.toLocaleString();

        // ì˜¤ëŠ˜ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸
        const list = document.getElementById('history-list');
        const dayData = state.dailyHistory[activeDate] || [];
        list.innerHTML = dayData.length ? dayData.map((item, i) => `
            <div class="history-item">
                <div class="item-info">
                    <b style="font-size:1.05rem;">${item.category}</b>
                    <span style="font-size:0.85rem; color:#888;">${item.note}</span>
                    <div style="margin-top:5px">
                        <span class="tag ${item.method==='í˜„ê¸ˆ'?'tag-cash':'tag-card'}">${item.method}</span>
                        <button class="delete-btn" onclick="deleteItem('${activeDate}', ${i})">ì‚­ì œ</button>
                    </div>
                </div>
                <div style="font-weight:800; font-size:1.15rem; color:${item.type==='plus'?'var(--income-color)':'var(--expense-color)'}">
                    ${item.type==='plus'?'+':'-'}Â¥${item.amount.toLocaleString()}
                </div>
            </div>
        `).join('') : '<p style="text-align:center; color:#ccc; padding:50px 0;">ì´ ë‚ ì˜ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';

        localStorage.setItem('smartLedgerData_V11', JSON.stringify(state));
    }

    function deleteItem(date, idx) {
        if(!confirm("ì´ ë‚´ì—­ì„ ì‚­ì œí• ê¹Œìš”?")) return;
        const item = state.dailyHistory[date][idx];
        if(item.method === 'í˜„ê¸ˆ') state.cash += (item.type==='plus' ? -item.amount : item.amount);
        else state.card += (item.type==='plus' ? -item.amount : item.amount);
        state.dailyHistory[date].splice(idx, 1);
        updateUI();
    }

    init();
</script>
</body>
</html>
