<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ í”„ë¦¬ë¯¸ì—„ ê°€ê³„ë¶€ (í†µê³„ & ë°±ì—…)</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --income-color: #2ecc71;
            --expense-color: #e74c3c;
            --bg-color: #f8f9fa;
            --cash-accent: #fcc419;
            --card-accent: #4dabf7;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 20px; display: flex; justify-content: center;
        }

        .app-container {
            width: 100%; max-width: 480px; background: white;
            border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden; position: relative; min-height: 90vh;
        }

        /* í—¤ë” & ëŒ€ì‹œë³´ë“œ */
        .header { background: #2c3e50; color: white; padding: 25px 20px; text-align: center; }
        .date-selector input {
            background: rgba(255,255,255,0.1); border: none; color: white;
            padding: 8px 15px; border-radius: 20px; font-size: 1rem; margin-bottom: 10px;
        }
        .total-amount { font-size: 2.5rem; font-weight: 800; margin: 5px 0; }
        
        .monthly-summary {
            display: flex; background: rgba(0,0,0,0.2); border-radius: 15px;
            margin: 15px 0; padding: 12px; font-size: 0.85rem; justify-content: space-around;
        }
        .summary-box span { display: block; opacity: 0.8; margin-bottom: 3px; }
        .summary-box b { font-size: 1rem; }

        .asset-split { display: flex; justify-content: space-around; gap: 10px; }
        .asset-item { flex: 1; background: rgba(255,255,255,0.05); padding: 12px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .asset-label { font-size: 0.8rem; font-weight: 600; margin-bottom: 4px; display: block; }
        #cash-balance { color: var(--cash-accent); }
        #card-balance { color: var(--card-accent); }

        /* ì…ë ¥ ì„¹ì…˜ */
        .input-box { padding: 20px; border-bottom: 8px solid #f0f2f5; }
        .main-input {
            width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 12px;
            font-size: 1.8rem; font-weight: bold; text-align: center; margin-bottom: 15px;
            box-sizing: border-box; outline: none;
        }
        .button-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .button-grid button { padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-plus { background: #e8f5e9; color: var(--income-color); }
        .btn-minus { background: #ffebee; color: var(--expense-color); }

        /* í†µê³„ ì„¹ì…˜ */
        .stats-section { padding: 20px; border-bottom: 8px solid #f0f2f5; }
        .chart-container { display: flex; align-items: center; gap: 15px; margin-top: 10px; }
        .chart-bar-wrap { flex: 1; background: #eee; height: 12px; border-radius: 6px; overflow: hidden; }
        .chart-bar { height: 100%; background: var(--expense-color); width: 0%; transition: 0.5s; }

        /* ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ */
        .history-section { padding: 20px; }
        .history-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; display: flex; justify-content: space-between; }
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f1f1f1; }
        .item-info { display: flex; flex-direction: column; gap: 4px; }
        .tag { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; margin-right: 5px; }
        .tag-cash { background: #fff9db; color: #f08c00; }
        .tag-card { background: #e7f5ff; color: #1971c2; }
        .delete-btn { background: none; border: none; color: #ccc; cursor: pointer; }

        /* ì„¤ì • (ë°±ì—…) */
        .settings-row { padding: 15px 20px; display: flex; gap: 10px; background: #fdfdfd; }
        .btn-small { flex: 1; padding: 8px; font-size: 0.75rem; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer; }

        /* ëª¨ë‹¬ */
        #modal-overlay {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 100; justify-content: center; align-items: center;
        }
        .modal { background: white; width: 90%; border-radius: 20px; padding: 25px; box-sizing: border-box; }
        .category-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .cat-btn { padding: 10px 5px; border: 1px solid #eee; border-radius: 10px; background: #f9f9f9; font-size: 0.8rem; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .cat-btn.active { background: var(--primary-color); color: white; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="modal-overlay">
        <div class="modal">
            <div id="modal-header-text" style="font-weight: bold; margin-bottom: 20px; text-align: center;">ë‚´ì—­ ì…ë ¥</div>
            <div class="category-grid" id="category-selector"></div>
            <input type="text" id="note-input" class="modal-input" style="width:100%; padding:12px; box-sizing:border-box; border:1px solid #ddd; border-radius:10px; margin-bottom:20px;" placeholder="ë©”ëª¨ ì…ë ¥">
            <div style="display:flex; gap:10px;">
                <button onclick="closeModal()" style="flex:1; padding:12px; border-radius:10px; border:none; background:#eee;">ì·¨ì†Œ</button>
                <button onclick="confirmTransaction()" style="flex:1; padding:12px; border-radius:10px; border:none; background:var(--primary-color); color:white; font-weight:bold;">ì €ì¥</button>
            </div>
        </div>
    </div>

    <div class="header">
        <div class="date-selector"><input type="date" id="date-picker" onchange="changeDate()"></div>
        <div class="total-amount" id="total-balance">Â¥0</div>
        
        <div class="monthly-summary">
            <div class="summary-box"><span>ì´ë²ˆ ë‹¬ ìˆ˜ì…</span><b id="month-in" style="color:#2ecc71">Â¥0</b></div>
            <div class="summary-box"><span>ì´ë²ˆ ë‹¬ ì§€ì¶œ</span><b id="month-out" style="color:#ff6b6b">Â¥0</b></div>
        </div>

        <div class="asset-split">
            <div class="asset-item"><span class="asset-label" style="color:var(--cash-accent)">í˜„ê¸ˆ ì”ì•¡</span><div id="cash-balance">Â¥0</div></div>
            <div class="asset-item"><span class="asset-label" style="color:var(--card-accent)">ì¹´ë“œ ì”ì•¡</span><div id="card-balance">Â¥0</div></div>
        </div>
    </div>

    <div class="settings-row">
        <button class="btn-small" onclick="exportData()">ğŸ“¦ ë°ì´í„° ë°±ì—…</button>
        <button class="btn-small" onclick="document.getElementById('file-input').click()">ğŸ“ ë³µêµ¬</button>
        <button class="btn-small" onclick="resetData()" style="color:red">ğŸ”„ ì´ˆê¸°í™”</button>
        <input type="file" id="file-input" style="display:none" onchange="importData(event)">
    </div>

    <div class="input-box">
        <input type="number" id="amount-input" class="main-input" inputmode="numeric" placeholder="0">
        <div class="button-grid">
            <button class="btn-plus" onclick="openModal('plus', 'cash')">í˜„ê¸ˆ ì…ê¸ˆ</button>
            <button class="btn-plus" onclick="openModal('plus', 'card')">ì¹´ë“œ ì…ê¸ˆ</button>
            <button class="btn-minus" onclick="openModal('minus', 'cash')">í˜„ê¸ˆ ì¶œê¸ˆ</button>
            <button class="btn-minus" onclick="openModal('minus', 'card')">ì¹´ë“œ ì¶œê¸ˆ</button>
        </div>
    </div>

    <div class="stats-section" id="stats-area">
        <div style="font-size:0.9rem; font-weight:bold; color:#666;">ì§€ì¶œ ë¹„ì¤‘</div>
        <div class="chart-container">
            <span id="top-cat-name" style="font-size:0.8rem; min-width:60px;">ë‚´ì—­ ì—†ìŒ</span>
            <div class="chart-bar-wrap"><div id="chart-bar" class="chart-bar"></div></div>
            <span id="top-cat-percent" style="font-size:0.8rem; font-weight:bold;">0%</span>
        </div>
    </div>

    <div class="history-section">
        <div class="history-title">ì˜¤ëŠ˜ì˜ ë‚´ì—­ <span id="item-count" style="font-size:0.8rem; color:#aaa; font-weight:normal;">0ê±´</span></div>
        <div id="history-list"></div>
    </div>
</div>

<script>
    const categories = {
        plus: [{name:'ì›”ê¸‰',icon:'ğŸ’°'},{name:'ìš©ëˆ',icon:'ğŸ'},{name:'ì´ì›”',icon:'ğŸ“…'},{name:'ë¶€ìˆ˜ì…',icon:'ğŸ“ˆ'},{name:'ê¸ˆìœµ',icon:'ğŸ¦'},{name:'ê¸°íƒ€',icon:'âœ¨'}],
        minus: [{name:'ì‹ë¹„',icon:'ğŸ”'},{name:'êµí†µë¹„',icon:'ğŸšŒ'},{name:'ì—¬ê°€/ì·¨ë¯¸',icon:'ğŸ®'},{name:'ì‡¼í•‘',icon:'ğŸ›ï¸'},{name:'ì˜ë£Œ',icon:'ğŸ¥'},{name:'ì£¼ê±°/í†µì‹ ',icon:'ğŸ '},{name:'êµìœ¡',icon:'ğŸ“š'},{name:'ê²½ì¡°ì‚¬',icon:'ğŸ’Œ'},{name:'ê¸°íƒ€',icon:'âœ¨'}]
    };

    let state = JSON.parse(localStorage.getItem('myLedgerData_V9')) || { cash: 0, card: 0, dailyHistory: {} };
    let currentDate = "";
    let currentTransaction = null;
    let selectedCategory = "";

    function init() {
        currentDate = new Date().toISOString().split('T')[0];
        document.getElementById('date-picker').value = currentDate;
        updateUI();
    }

    function changeDate() { currentDate = document.getElementById('date-picker').value; updateUI(); }

    function openModal(type, method) {
        const amt = parseInt(document.getElementById('amount-input').value);
        if(!amt || amt <= 0) return alert("ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.");
        currentTransaction = { type, method, amount: amt };
        selectedCategory = "";
        document.getElementById('note-input').value = "";
        document.getElementById('modal-header-text').innerText = `${method==='cash'?'í˜„ê¸ˆ':'ì¹´ë“œ'} ${type==='plus'?'ì…ê¸ˆ':'ì¶œê¸ˆ'} (Â¥${amt.toLocaleString()})`;
        
        const selector = document.getElementById('category-selector');
        selector.innerHTML = "";
        categories[type].forEach(cat => {
            const btn = document.createElement('button');
            btn.className = 'cat-btn';
            btn.innerHTML = `<span>${cat.icon}</span>${cat.name}`;
            btn.onclick = () => { document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); selectedCategory = cat.name; };
            selector.appendChild(btn);
        });
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

    function confirmTransaction() {
        if(!selectedCategory) return alert("ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
        const { type, method, amount } = currentTransaction;
        if(method === 'cash') state.cash += (type==='plus'? amount : -amount);
        else state.card += (type==='plus'? amount : -amount);

        if(!state.dailyHistory[currentDate]) state.dailyHistory[currentDate] = [];
        state.dailyHistory[currentDate].unshift({ type, method: method==='cash'?'í˜„ê¸ˆ':'ì¹´ë“œ', category: selectedCategory, note: document.getElementById('note-input').value || selectedCategory, amount });

        document.getElementById('amount-input').value = '';
        closeModal();
        updateUI();
    }

    function updateUI() {
        // ê¸°ë³¸ ì”ì•¡
        document.getElementById('cash-balance').innerText = "Â¥" + state.cash.toLocaleString();
        document.getElementById('card-balance').innerText = "Â¥" + state.card.toLocaleString();
        const total = state.cash + state.card;
        document.getElementById('total-balance').innerText = "Â¥" + total.toLocaleString();
        document.getElementById('total-balance').style.color = total >= 0 ? "var(--income-color)" : "var(--expense-color)";

        // ì´ë²ˆ ë‹¬ í†µê³„ ê³„ì‚°
        const curMonth = currentDate.substring(0, 7); // YYYY-MM
        let mIn = 0, mOut = 0;
        let catStats = {};

        Object.keys(state.dailyHistory).forEach(date => {
            if(date.startsWith(curMonth)) {
                state.dailyHistory[date].forEach(item => {
                    if(item.type === 'plus') mIn += item.amount;
                    else {
                        mOut += item.amount;
                        catStats[item.category] = (catStats[item.category] || 0) + item.amount;
                    }
                });
            }
        });

        document.getElementById('month-in').innerText = "Â¥" + mIn.toLocaleString();
        document.getElementById('month-out').innerText = "Â¥" + mOut.toLocaleString();

        // ì§€ì¶œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        const sortedCats = Object.entries(catStats).sort((a,b) => b[1] - a[1]);
        if(sortedCats.length > 0 && mOut > 0) {
            const top = sortedCats[0];
            const percent = Math.round((top[1] / mOut) * 100);
            document.getElementById('top-cat-name').innerText = top[0];
            document.getElementById('top-cat-percent').innerText = percent + "%";
            document.getElementById('chart-bar').style.width = percent + "%";
        } else {
            document.getElementById('top-cat-name').innerText = "ë‚´ì—­ ì—†ìŒ";
            document.getElementById('chart-bar').style.width = "0%";
            document.getElementById('top-cat-percent').innerText = "0%";
        }

        // ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
        const list = document.getElementById('history-list');
        const dayData = state.dailyHistory[currentDate] || [];
        document.getElementById('item-count').innerText = `${dayData.length}ê±´`;
        list.innerHTML = dayData.length ? dayData.map((item, i) => `
            <div class="history-item">
                <div class="item-info">
                    <b class="item-category">${item.category}</b>
                    <span class="item-note">${item.note}</span>
                    <div style="margin-top:5px"><span class="tag ${item.method==='í˜„ê¸ˆ'?'tag-cash':'tag-card'}">${item.method}</span><button class="delete-btn" onclick="deleteItem(${i})">ì‚­ì œ</button></div>
                </div>
                <div style="font-size:1.1rem; font-weight:800; color:${item.type==='plus'?'var(--income-color)':'var(--expense-color)'}">
                    ${item.type==='plus'?'+':'-'}Â¥${item.amount.toLocaleString()}
                </div>
            </div>
        `).join('') : '<p style="text-align:center; color:#ccc; padding:30px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';

        localStorage.setItem('myLedgerData_V9', JSON.stringify(state));
    }

    function deleteItem(idx) {
        if(!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
        const item = state.dailyHistory[currentDate][idx];
        if(item.method === 'í˜„ê¸ˆ') state.cash += (item.type==='plus' ? -item.amount : item.amount);
        else state.card += (item.type==='plus' ? -item.amount : item.amount);
        state.dailyHistory[currentDate].splice(idx, 1);
        updateUI();
    }

    // ë°±ì—… ë° ë³µêµ¬ ê¸°ëŠ¥
    function exportData() {
        const data = JSON.stringify(state);
        const blob = new Blob([data], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `ê°€ê³„ë¶€_ë°±ì—…_${currentDate}.json`;
        a.click();
    }

    function importData(e) {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                state = JSON.parse(e.target.result);
                updateUI();
                alert("ì„±ê³µì ìœ¼ë¡œ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
            } catch(e) { alert("ì˜ëª»ëœ íŒŒì¼ì…ë‹ˆë‹¤."); }
        };
        reader.readAsText(file);
    }

    function resetData() {
        if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì§€ìš°ê³  ì´ˆê¸°í™”í• ê¹Œìš”? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
            state = { cash: 0, card: 0, dailyHistory: {} };
            updateUI();
        }
    }

    init();
</script>
</body>
</html>
