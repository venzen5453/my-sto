<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ì‹¬í”Œ ìŠ¤ë§ˆíŠ¸ ê°€ê³„ë¶€</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --income-color: #2ecc71;
            --expense-color: #e74c3c;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --header-bg: #2c3e50;
            --text-main: #2c3e50;
            --cash-accent: #fcc419;
            --card-accent: #4dabf7;
            --border-color: #f1f1f1;
        }

        /* [ìˆ˜ì •] ì›¹ ìŠ¤í¬ë¡¤ ë°©ì§€ ë° ê³ ì • ë ˆì´ì•„ì›ƒ */
        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 0; 
            display: flex; justify-content: center;
            color: var(--text-main);
            overflow: hidden; /* ì „ì²´ ìŠ¤í¬ë¡¤ ì°¨ë‹¨ */
            height: 100vh;
        }

        .app-container {
            width: 100%; max-width: 480px; background: var(--card-bg);
            height: 100vh;
            display: flex; flex-direction: column; /* ì„¸ë¡œ ë°°ì¹˜ */
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
        }

        .header { 
            background: var(--header-bg); 
            color: white; 
            padding: 20px 20px 15px 20px; 
            text-align: center;
            flex-shrink: 0; /* í—¤ë” í¬ê¸° ê³ ì • */
        }

        .date-nav { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 8px; }
        .date-nav button { background: none; border: none; color: white; font-size: 1rem; cursor: pointer; }
        .date-nav input { background: rgba(255,255,255,0.1); border: none; color: white; padding: 4px 8px; border-radius: 8px; font-size: 0.85rem; }

        .total-amount { font-size: 2.2rem; font-weight: 800; margin: 5px 0; }
        
        .monthly-summary {
            display: flex; background: rgba(0,0,0,0.2); border-radius: 12px;
            margin: 10px 0; padding: 10px; font-size: 0.75rem; justify-content: space-around;
        }
        .summary-box span { display: block; opacity: 0.7; }
        .summary-box b { font-size: 1rem; }

        .asset-split { display: flex; justify-content: space-around; gap: 8px; }
        .asset-item { flex: 1; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); }
        .asset-label { font-size: 0.75rem; margin-bottom: 2px; display: block; }

        /* [ìˆ˜ì •] ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ ìŠ¤í¬ë¡¤ ì„¤ì • */
        .content-area {
            flex: 1;
            overflow-y: auto; /* ë‚´ì—­ì´ ë§ì„ ë•Œë§Œ ìŠ¤í¬ë¡¤ */
            padding: 20px;
            padding-bottom: 80px; /* í•˜ë‹¨ë°” ì—¬ë°± */
        }

        .main-input {
            width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 10px;
            font-size: 1.5rem; font-weight: bold; text-align: center; margin-bottom: 12px;
            box-sizing: border-box; outline: none; background: var(--bg-color); color: var(--text-main);
        }

        .button-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .button-grid button { padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 0.9rem; }

        /* [ìˆ˜ì •] í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜ í¬ê¸° ì¶•ì†Œ */
        .nav-bar {
            position: absolute; bottom: 0; width: 100%; 
            height: 55px; /* ë†’ì´ ì¶•ì†Œ */
            background: var(--card-bg); border-top: 1px solid var(--border-color);
            display: flex; justify-content: space-around; align-items: center; z-index: 1000;
        }
        .nav-item { border: none; background: none; color: #ccc; font-size: 0.7rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .nav-item.active { color: var(--primary-color); font-weight: bold; }
        .nav-item.disabled { opacity: 0.4; cursor: default; } /* ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼ */
        .nav-icon { font-size: 1.1rem; }

        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
        .tag { padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; font-weight: bold; margin-right: 5px; }
        .tag-cash { background: #fff9db; color: #f08c00; }
        .tag-card { background: #e7f5ff; color: #1971c2; }
        .delete-btn { background: none; border: none; color: #ddd; cursor: pointer; font-size: 0.7rem; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; }
        .modal { background: var(--card-bg); width: 85%; max-width: 350px; border-radius: 20px; padding: 20px; }
        .category-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .cat-btn { padding: 8px 4px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-color); color: var(--text-main); font-size: 0.75rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .cat-btn.active { background: var(--primary-color); color: white; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="modal-overlay">
        <div class="modal">
            <div style="font-weight: bold; margin-bottom: 15px; text-align: center;">ë¶„ë¥˜ ì„ íƒ</div>
            <div class="category-grid" id="category-selector"></div>
            <input type="text" id="note-input" class="main-input" style="font-size:0.9rem !important; text-align:left;" placeholder="ìƒì„¸ ë©”ëª¨ (ì„ íƒ)">
            <div style="display:flex; gap:10px;">
                <button onclick="closeModal()" style="flex:1; padding:10px; border:none; background:#eee; border-radius:10px;">ì·¨ì†Œ</button>
                <button onclick="confirmTransaction()" style="flex:1; padding:10px; border:none; background:var(--primary-color); color:white; border-radius:10px; font-weight:bold;">ì €ì¥</button>
            </div>
        </div>
    </div>

    <div class="header">
        <div class="date-nav">
            <button onclick="moveDate(-1)">â—€</button>
            <input type="date" id="date-picker" onchange="updateUI()">
            <button onclick="moveDate(1)">â–¶</button>
        </div>
        <div class="total-amount" id="total-balance">Â¥0</div>
        
        <div class="monthly-summary">
            <div class="summary-box"><span>í•œ ë‹¬ ìˆ˜ì…</span><b id="month-in" style="color:#2ecc71">Â¥0</b></div>
            <div class="summary-box"><span>í•œ ë‹¬ ì§€ì¶œ</span><b id="month-out" style="color:#ff6b6b">Â¥0</b></div>
        </div>

        <div class="asset-split">
            <div class="asset-item"><span class="asset-label" style="color:var(--cash-accent)">í˜„ê¸ˆ</span><div id="cash-balance" style="font-weight:800; font-size:1rem; color:var(--cash-accent)">Â¥0</div></div>
            <div class="asset-item"><span class="asset-label" style="color:var(--card-accent)">ì¹´ë“œ</span><div id="card-balance" style="font-weight:800; font-size:1rem; color:var(--card-accent)">Â¥0</div></div>
        </div>
    </div>

    <div class="content-area" id="main-scroll-area">
        <input type="number" id="amount-input" class="main-input" inputmode="numeric" placeholder="ê¸ˆì•¡ ì…ë ¥">
        <div class="button-grid">
            <button style="background:#e8f5e9; color:#2ecc71;" onclick="openModal('plus', 'cash')">í˜„ê¸ˆ ì…ê¸ˆ</button>
            <button style="background:#e8f5e9; color:#2ecc71;" onclick="openModal('plus', 'card')">ì¹´ë“œ ì…ê¸ˆ</button>
            <button style="background:#ffebee; color:#e74c3c;" onclick="openModal('minus', 'cash')">í˜„ê¸ˆ ì¶œê¸ˆ</button>
            <button style="background:#ffebee; color:#e74c3c;" onclick="openModal('minus', 'card')">ì¹´ë“œ ì¶œê¸ˆ</button>
        </div>
        
        <h4 style="margin: 20px 0 10px 0; font-size: 0.9rem;">ì˜¤ëŠ˜ì˜ ê±°ë˜ ë‚´ì—­</h4>
        <div id="history-list"></div>
    </div>

    <nav class="nav-bar">
        <button class="nav-item active"><span class="nav-icon">ğŸ </span>í™ˆ</button>
        <button class="nav-item disabled"><span class="nav-icon">ğŸ”</span>ê²€ìƒ‰</button>
        <button class="nav-item disabled"><span class="nav-icon">âš™ï¸</span>ì„¤ì •</button>
    </nav>
</div>

<script>
    const categories = {
        plus: [{name:'ì›”ê¸‰',icon:'ğŸ’°'},{name:'ìš©ëˆ',icon:'ğŸ'},{name:'ë¶€ìˆ˜ì…',icon:'ğŸ“ˆ'},{name:'ê¸ˆìœµ',icon:'ğŸ¦'},{name:'ê¸°íƒ€',icon:'âœ¨'}],
        minus: [{name:'ì‹ë¹„',icon:'ğŸ”'},{name:'êµí†µë¹„',icon:'ğŸšŒ'},{name:'ì—¬ê°€',icon:'ğŸ®'},{name:'ì‡¼í•‘',icon:'ğŸ›ï¸'},{name:'ì˜ë£Œ',icon:'ğŸ¥'},{name:'ê¸°íƒ€',icon:'âœ¨'}]
    };

    let state = JSON.parse(localStorage.getItem('finalLedgerData_V1')) || { cash: 0, card: 0, dailyHistory: {} };
    let currentTransaction = null;
    let selectedCategory = "";

    function init() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date-picker').value = today;
        updateUI();
    }

    function moveDate(offset) {
        const picker = document.getElementById('date-picker');
        let d = new Date(picker.value);
        d.setDate(d.getDate() + offset);
        picker.value = d.toISOString().split('T')[0];
        updateUI();
    }

    function openModal(type, method) {
        const amt = parseInt(document.getElementById('amount-input').value);
        if(!amt) return alert("ê¸ˆì•¡ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.");
        currentTransaction = { type, method, amount: amt };
        selectedCategory = "";
        const selector = document.getElementById('category-selector');
        selector.innerHTML = categories[type].map(cat => `
            <button class="cat-btn" onclick="selectCat('${cat.name}', this)">
                <span style="font-size:1.1rem">${cat.icon}</span>${cat.name}
            </button>`).join('');
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function selectCat(name, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedCategory = name;
    }

    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

    function confirmTransaction() {
        if(!selectedCategory) return alert("ë¶„ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
        const date = document.getElementById('date-picker').value;
        const { type, method, amount } = currentTransaction;
        
        if(method === 'cash') state.cash += (type==='plus'? amount : -amount);
        else state.card += (type==='plus'? amount : -amount);
        
        if(!state.dailyHistory[date]) state.dailyHistory[date] = [];
        state.dailyHistory[date].unshift({ 
            type, 
            method: method==='cash'?'í˜„ê¸ˆ':'ì¹´ë“œ', 
            category: selectedCategory, 
            note: document.getElementById('note-input').value || selectedCategory, 
            amount 
        });
        
        document.getElementById('amount-input').value = "";
        document.getElementById('note-input').value = "";
        closeModal();
        updateUI();
    }

    function updateUI() {
        const activeDate = document.getElementById('date-picker').value;
        const curMonth = activeDate.substring(0, 7);

        document.getElementById('cash-balance').innerText = "Â¥" + state.cash.toLocaleString();
        document.getElementById('card-balance').innerText = "Â¥" + state.card.toLocaleString();
        
        const total = state.cash + state.card;
        const totalEl = document.getElementById('total-balance');
        totalEl.innerText = "Â¥" + total.toLocaleString();
        totalEl.style.color = total >= 0 ? "white" : "#ff6b6b";

        let mIn = 0, mOut = 0;
        Object.keys(state.dailyHistory).forEach(date => {
            if(date.startsWith(curMonth)) {
                state.dailyHistory[date].forEach(item => {
                    if(item.type === 'plus') mIn += item.amount;
                    else mOut += item.amount;
                });
            }
        });
        document.getElementById('month-in').innerText = "Â¥" + mIn.toLocaleString();
        document.getElementById('month-out').innerText = "Â¥" + mOut.toLocaleString();

        const list = document.getElementById('history-list');
        const dayData = state.dailyHistory[activeDate] || [];
        list.innerHTML = dayData.map((item, i) => `
            <div class="history-item">
                <div style="font-size:0.85rem;"><b>${item.category}</b> <small style="color:#888;">| ${item.note}</small><br>
                <span class="tag ${item.method==='í˜„ê¸ˆ'?'tag-cash':'tag-card'}">${item.method}</span>
                <button class="delete-btn" onclick="deleteItem('${activeDate}', ${i})">ì‚­ì œ</button></div>
                <div style="font-weight:bold; font-size:0.9rem; color:${item.type==='plus'?'var(--income-color)':'var(--expense-color)'}">
                    ${item.type==='plus'?'+':'-'}Â¥${item.amount.toLocaleString()}
                </div>
            </div>
        `).join('') || '<p style="text-align:center; color:#ccc; padding:30px; font-size:0.8rem;">ë‚´ì—­ ì—†ìŒ</p>';
        save();
    }

    function deleteItem(date, i) {
        if(!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const item = state.dailyHistory[date][i];
        if(item.method === 'í˜„ê¸ˆ') state.cash += (item.type==='plus' ? -item.amount : item.amount);
        else state.card += (item.type==='plus' ? -item.amount : item.amount);
        state.dailyHistory[date].splice(i, 1);
        updateUI();
    }

    function save() { localStorage.setItem('finalLedgerData_V1', JSON.stringify(state)); }

    init();
</script>
</body>
</html>
