<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>裏拍メトロノーム — Ultra Premium Web Edition</title>

<!-- ===== Part 2에서 CSS가 이어집니다 ===== -->

</head>

<body>
<div class="wrap">
<div class="card">

<h1>裏拍メトロノーム（Ultra Premium 版）</h1>

<!-- =============================== -->
<!--        기본 메트로놈 패널       -->
<!-- =============================== -->

<div class="panel">

  <!-- BPM + Tap Tempo -->
  <div class="row">
    <label>BPM</label>
    <input id="bpm" type="range" min="30" max="300" value="100">
    <input id="bpmNum" type="number" min="30" max="300" value="100">
    <button id="tapBtn" class="btn-secondary">TAP</button>
  </div>

  <!-- 拍子 -->
  <div class="row">
    <label>拍子</label>
    <input id="beats" type="range" min="1" max="12" value="4">
    <input id="beatsNum" type="number" min="1" max="12" value="4">
  </div>

  <!-- Beat Grid -->
  <div id="beatGrid" class="beatGrid"></div>

  <!-- Volume -->
  <div class="row">
    <label>音量</label>
    <input id="vol" type="range" min="0" max="1" step="0.01" value="0.7">
    <input id="volNum" type="number" min="0" max="1" step="0.01" value="0.7">
  </div>

  <!-- Subdivision -->
  <div class="row">
    <label>細分化</label>
    <select id="subdiv">
      <option value="1">なし</option>
      <option value="2">8分（2分割）</option>
      <option value="3">3連符</option>
      <option value="4">16分（4分割）</option>
    </select>
  </div>

  <!-- Swing -->
  <div class="row">
    <input id="swingToggle" type="checkbox">
    <label for="swingToggle">スウィング（Shuffle）</label>
  </div>

  <!-- Offbeat -->
  <div class="row">
    <input id="offbeatToggle" type="checkbox" checked>
    <label>裏拍を鳴らす</label>
  </div>

  <!-- Auto BPM Up -->
  <div class="row">
    <input id="autoBpm" type="checkbox">
    <label>自動テンポ上昇</label>
    <input id="autoStep" type="number" min="1" max="20" value="2" style="width:60px">
  </div>

  <!-- Session Timer -->
  <div class="row">
    <label>セッション</label>
    <select id="sessionTimer">
      <option value="0">なし</option>
      <option value="60">1分</option>
      <option value="180">3分</option>
      <option value="300">5分</option>
    </select>
  </div>

  <!-- Count-In -->
  <div class="row">
    <input id="countInToggle" type="checkbox">
    <label>カウントイン（4拍）</label>
  </div>

  <!-- Pattern Maker -->
  <div class="row">
    <label>パターン</label>
    <select id="patternSelect">
      <option value="default">標準（強拍のみ）</option>
      <option value="custom">カスタム</option>
      <option value="rock">Rock（1・3 強）</option>
      <option value="backbeat">Backbeat（2・4 強）</option>
      <option value="clave">Clave（3-2）</option>
    </select>
  </div>

  <div id="customPatternArea" style="margin:10px 0;display:none">
    <div>カスタム強拍設定:</div>
    <div id="patternButtons" style="display:flex;gap:8px;margin-top:6px"></div>
  </div>

  <!-- Drum Sound -->
  <div class="row">
    <label>音色</label>
    <select id="soundType">
      <option value="click">Click</option>
      <option value="snare">Snare</option>
      <option value="hihat">Hi-Hat</option>
      <option value="kick">Kick</option>
    </select>
  </div>

  <!-- Poly Rhythm -->
  <div class="row">
    <label>ポリリズム</label>
    <input id="polyA" type="number" min="1" max="12" value="0"> :
    <input id="polyB" type="number" min="1" max="12" value="0">
    <span style="font-size:12px;color:var(--muted)">（0 = 無効）</span>
  </div>

  <!-- BPM Curve -->
  <div class="row">
    <label>BPMカーブ</label>
    <select id="bpmCurve">
      <option value="none">なし</option>
      <option value="accel">Accelerando（徐々に速く）</option>
      <option value="rit">Ritardando（徐々に遅く）</option>
    </select>
  </div>

  <!-- Loop Training -->
  <div class="row">
    <label>ループ練習</label>
    <select id="loopMode">
      <option value="none">なし</option>
      <option value="2-4">2拍再生 → 4拍無音</option>
      <option value="4-4">4拍 → 4拍無音</option>
      <option value="custom">カスタム</option>
    </select>
  </div>

  <div id="customLoopArea" style="display:none;margin-top:6px">
    <label>再生</label>
    <input id="loopOn" type="number" min="1" max="32" value="4">
    <label>無音</label>
    <input id="loopOff" type="number" min="1" max="32" value="4">
  </div>

  <!-- Timing Accuracy -->
  <div class="row">
    <button id="accuracyStart" class="btn-secondary">精度テスト開始</button>
    <button id="accuracyReset" class="btn-danger">リセット</button>
  </div>
  <div id="accuracyResult" style="font-size:14px;color:var(--muted);margin-top:4px">
    （Space キーで測定）
  </div>

  <!-- Visualizer -->
  <div class="row">
    <label>ビジュアライザー</label>
    <select id="visualMode">
      <option value="pulse">Pulse</option>
      <option value="sweep">Sweep</option>
      <option value="bars">Bars</option>
    </select>
  </div>

  <!-- Presets -->
  <div class="row">
    <button id="presetSave" class="btn-secondary">プリセット保存</button>
    <select id="presetList"><option value="0">プリセットなし</option></select>
    <button id="presetLoad" class="btn-primary">読込</button>
  </div>

  <!-- Start / Stop -->
  <button id="playToggle" class="btn-primary" style="margin-top:10px">▶ スタート</button>
  <button id="panicBtn" class="btn-danger" style="margin-top:6px">■ 停止</button>

  <!-- Pulse -->
  <div id="pulse"></div>

  <!-- Beat Progress -->
  <div class="row">
    <label>進行</label>
    <div class="meter" style="flex:1"><div id="bar" class="bar"></div></div>
    <span id="beatNow" class="kbd">–</span>
  </div>

  <!-- Offbeat Lamp -->
  <div style="text-align:center;margin-top:10px">
    <div id="offbeatLamp" style="
      width:22px;height:22px;border-radius:50%;background:#ccc;
      box-shadow:0 0 6px rgba(0,0,0,.2);margin:auto"></div>
    <div style="font-size:12px;color:var(--muted)">裏拍インジケーター</div>
  </div>

  <!-- Dark Mode -->
  <div class="row" style="justify-content:center;margin-top:10px">
    <button id="themeToggle" class="btn-secondary">🌙 ダークモード</button>
  </div>

  <!-- Click Track Export -->
  <div class="row" style="justify-content:center;margin-top:16px">
    <button id="exportWav" class="btn-primary">WAV書き出し</button>
  </div>

  <!-- Practice History -->
  <div class="row" style="margin-top:12px">
    <button id="showHistory" class="btn-secondary">練習履歴を見る</button>
  </div>
  <div id="historyArea" style="
    margin-top:10px;font-size:13px;color:var(--muted);display:none"></div>

</div>

</div></div>

<!-- ===== Part 3, 4, 5에서 JavaScript가 이어집니다 ===== -->

</body>
</html>
